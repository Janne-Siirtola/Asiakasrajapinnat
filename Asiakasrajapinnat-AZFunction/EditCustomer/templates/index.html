<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>{% if customer %}Edit Customer: {{ customer.name | upper }}{% else %}Select Customer to Edit{% endif %}</title>
  <style>
    /* Basic page layout */
    body {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 700px;
      margin: 0 auto;
      background-color: #ffffff;
      padding: 20px 30px;
      border-radius: 6px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #333333;
    }
    ul.customer-list {
      list-style: none;
      padding: 0;
    }
    ul.customer-list li {
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      background-color: #f7f7f7;
      border: 1px solid #dddddd;
      border-radius: 4px;
    }
    ul.customer-list li span.name {
      font-weight: 600;
      color: #444444;
    }
    ul.customer-list li a.edit-btn {
      text-decoration: none;
      background-color: #0078D4;
      color: #ffffff;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 13px;
    }
    ul.customer-list li a.edit-btn:hover {
      background-color: #005A9E;
    }

    /* Form groups */
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: #555555;
    }
    .form-group input,
    .form-group select {
      width: 100%;
      padding: 8px 10px;
      box-sizing: border-box;
      border: 1px solid #cccccc;
      border-radius: 4px;
      font-size: 14px;
      background-color: #ffffff;
      color: #333333;
    }
    .form-group select:focus,
    .form-group input:focus {
      border-color: #0078D4;
      outline: none;
    }

    /* Fieldset styling */
    fieldset {
      border: 1px solid #cccccc;
      padding: 15px 20px;
      margin-bottom: 20px;
      border-radius: 4px;
      background-color: #fafafa;
    }
    legend {
      padding: 0 8px;
      font-weight: 600;
      color: #333333;
    }

    /* Extra-columns block styling */
    .extra-columns-group {
      margin-bottom: 12px;
      padding: 12px;
      border: 1px solid #dddddd;
      border-radius: 4px;
      background-color: #f7f7f7;
      position: relative;
    }
    .extra-columns-group .form-group {
      margin-bottom: 8px;
    }
    .extra-columns-group label {
      font-weight: 500;
      color: #444444;
    }
    .extra-columns-group .removeColumnBtn {
      position: absolute;
      top: 10px;
      right: 10px;
      background-color: #E81123;
      color: #ffffff;
      border: none;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 13px;
      cursor: pointer;
    }
    .extra-columns-group .removeColumnBtn:hover {
      background-color: #C50F1F;
    }

    /* Buttons */
    #addExtraColumnBtn {
      background-color: #0078D4;
      color: #ffffff;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin-top: 10px;
    }
    #addExtraColumnBtn:hover {
      background-color: #005A9E;
    }
    .submit-btn {
      display: block;
      width: 100%;
      margin-top: 20px;
      font-size: 16px;
      padding: 10px 0;
      border-radius: 4px;
      background-color: #0078D4;
      color: white;
      border: none;
      cursor: pointer;
    }
    .submit-btn:hover {
      background-color: #005A9E;
    }
  </style>
</head>
<body>
  <div class="container">
    {% if not customer %}
      <h1>Select a Customer to Edit</h1>

      {% if customers %}
        <ul class="customer-list">
          {% for cust in customers %}
            <li>
              <span class="name">{{ cust.name }}</span>
              <a class="edit-btn" href="?name={{ cust.name }}">Edit</a>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p>No customers found.</p>
      {% endif %}

    {% else %}
      <h1>Edit Customer: {{ customer.name | upper }}</h1>

  <form id="editForm" method="post" action="">
    <!-- Customer Name (readonly) -->
    <div class="form-group">
      <label for="name">Customer Name</label>
      <input
        type="text"
        id="name"
        name="name"
        value="{{ customer.name }}"
        readonly
      />
    </div>

    <!-- Concern Number(s) -->
    <div class="form-group">
      <label for="konserni">Concern Number(s)</label>
      <input
        type="text"
        id="konserni"
        name="konserni"
        value="{{ customer.konserni | join(',') }}"
        required
      />
      <small style="color: #666666; font-size: 12px;">
        Separate multiple numbers with commas
      </small>
    </div>

    <!-- Source Container -->
    <div class="form-group">
      <label for="src_container">Source Container</label>
      <input
        type="text"
        id="src_container"
        name="src_container"
        value="{{ customer.source_container }}"
        required
      />
    </div>

    <!-- Destination Container -->
    <div class="form-group">
      <label for="dest_container">Destination Container</label>
      <input
        type="text"
        id="dest_container"
        name="dest_container"
        value="{{ customer.destination_container }}"
        required
      />
    </div>

    <!-- File Format -->
    <div class="form-group">
      <label for="file_format">File Format</label>
      <select id="file_format" name="file_format" required>
        <option value="json" {% if customer.file_format == 'json' %}selected{% endif %}>JSON</option>
        <option value="csv" {% if customer.file_format == 'csv' %}selected{% endif %}>CSV</option>
      </select>
    </div>

        <!-- 6) Extra Columns -->
        <fieldset>
          <legend>Extra Columns (optional)</legend>

          <div id="extraColumnsContainer">
            {% for key, info in customer.extra_columns.items() %}
              <div class="extra-columns-group">
                <button type="button" class="removeColumnBtn">Remove</button>
                <div class="form-group">
                  <label>Column Key</label>
                  <input
                    type="text"
                    name="extra_key"
                    value="{{ key }}"
                  />
                </div>
                <div class="form-group">
                  <label>Display Name</label>
                  <input
                    type="text"
                    name="extra_name"
                    value="{{ info.name }}"
                  />
                </div>
                <div class="form-group">
                  <label>Data Type</label>
                  <input
                    type="text"
                    name="extra_dtype"
                    value="{{ info.dtype }}"
                  />
                </div>
              </div>
            {% endfor %}
          </div>

          <!-- Template block (hidden) for adding new extra columns -->
          <div
            id="extraColumnTemplate"
            class="extra-columns-group"
            style="display: none;"
          >
            <button type="button" class="removeColumnBtn">Remove</button>
            <div class="form-group">
              <label>Column Key</label>
              <input
                type="text"
                name="extra_key"
                placeholder="e.g. PRTName"
              />
            </div>
            <div class="form-group">
              <label>Display Name</label>
              <input
                type="text"
                name="extra_name"
                placeholder="e.g. Asiakasryhma"
              />
            </div>
            <div class="form-group">
              <label>Data Type</label>
              <input
                type="text"
                name="extra_dtype"
                placeholder="e.g. string"
              />
            </div>
          </div>

          <button type="button" id="addExtraColumnBtn">+ Add Extra Column</button>
        </fieldset>

        <!-- 7) Exclude Columns -->
        <div class="form-group">
          <label for="exclude_columns">Exclude From Base Columns (optional)</label>
          <input
            type="text"
            id="exclude_columns"
            name="exclude_columns"
            value="{{ customer.exclude_columns | join(',') }}"
          />
          <small style="color: #666666; font-size: 12px;">
            Separate multiple column keys with commas
          </small>
        </div>

        <!-- 8) Submit Button -->
        <button type="submit" class="submit-btn">Save Changes</button>
      </form>
    {% endif %}
  </div>

  <script>
    (function() {
      const form = document.getElementById("editForm");
      const container = document.getElementById("extraColumnsContainer");
      const template = document.getElementById("extraColumnTemplate");
      const addBtn = document.getElementById("addExtraColumnBtn");

      // If no “edit” form is on screen, do nothing
      if (!form) return;

      // Wire up “Remove” buttons on any pre-existing extra-column groups
      container.querySelectorAll(".extra-columns-group").forEach(group => {
        const removeBtn = group.querySelector(".removeColumnBtn");
        removeBtn.addEventListener("click", () => {
          container.removeChild(group);
        });
      });

      function addExtraColumn() {
        // Clone the template (deep clone), make it visible, attach a remove handler
        const clone = template.cloneNode(true);
        clone.style.display = "";
        clone.removeAttribute("id");

        // Wire up the “Remove Column” button inside this cloned block
        clone
          .querySelector(".removeColumnBtn")
          .addEventListener("click", function() {
            container.removeChild(clone);
          });

        container.appendChild(clone);
      }

      addBtn.addEventListener("click", addExtraColumn);
    })();
  </script>
</body>
</html>
