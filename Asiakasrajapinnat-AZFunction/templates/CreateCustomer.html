<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Asiakasrajapinnat - Create Customer</title>
  {% if css_blocks %}
    <style>
      {%- for block in css_blocks %}
        {{ block | safe }}
      {%- endfor %}
    </style>
  {% endif %}
</head>
<body>
  {# only render the container if there are any messages #}
  {% if messages %}
    <div id="flash-container">
      {% for msg in messages %}
        <div class="flash {{ msg.category }}">
          {{ msg.message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}
  <div class="container">
    <h1>Create Customer Form</h1>

    <form id="configForm" method="post" action="">
      <!-- Customer Name -->
      <div class="form-group">
        <label for="name">Customer Name</label>
        <input
          type="text"
          id="name"
          name="name"
          placeholder="e.g. yit"
          required
        />
      </div>

      <!-- Concern Numbers -->
      <div class="form-group">
        <label for="konserni">Concern Number(s)</label>
        <input
          type="text"
          id="konserni"
          name="konserni"
          placeholder="e.g. 2208, 1234"
          required
        />
        <small style="color: #666666; font-size: 12px;">
          Separate multiple numbers with commas
        </small>
      </div>

      <!-- Source Container -->
      <div class="form-group">
        <label for="src_container">Source Container</label>
        <input
          type="text"
          id="src_container"
          name="src_container"
          placeholder="e.g. testi"
          required
        />
      </div>

      <!-- Destination Container -->
      <div class="form-group">
        <label for="dest_container">Destination Container</label>
        <input
          type="text"
          id="dest_container"
          name="dest_container"
          placeholder="e.g. testi"
          required
        />
      </div>

        <!-- File Format -->
        <div class="form-group">
        <label for="file_format">File Format</label>
        <select id="file_format" name="file_format" required>
            <option value="json">JSON</option>
            <option value="csv">CSV</option>
          </select>
        </div>
        
        <!-- Extra Columns -->
        <fieldset>
          <legend>Extra Columns (optional)</legend>
        <!-- This wrapper will contain zero or more “.extra-columns-group” blocks -->
        <div id="extraColumnsContainer"></div>

        <!-- A template we’ll clone when “Add Column” is clicked -->
        <div
          id="extraColumnTemplate"
          class="extra-columns-group"
          style="display: none;"
          >
          <div class="form-group">
            <label>Column Key</label>
            <input
            type="text"
            name="extra_key"
            placeholder="e.g. PRTName"
            />
          </div>
          <div class="form-group">
            <label>Display Name</label>
            <input
            type="text"
            name="extra_name"
            placeholder="e.g. Asiakasryhma"
            />
          </div>
          <div class="form-group">
            <label>Data Type</label>
            <select name="extra_dtype" id="extra_dtype">
              <option value="string">String</option>
              <option value="float">Float</option>
            </select>
          </div>
          <button type="button" class="removeColumnBtn">Remove Column</button>
        </div>

        <button type="button" id="addExtraColumnBtn">+ Add Extra Column</button>
      </fieldset>

      <!-- Exclude Columns -->
      <div class="form-group">
        <label for="exclude_columns">Exclude From Base Columns (optional)</label>
        <input
          type="text"
          id="exclude_columns"
          name="exclude_columns"
          placeholder="e.g. PARName1, TAPKaatop"
        />
        <small style="color: #666666; font-size: 12px;">
          Separate multiple column keys with commas
        </small>
      </div>

      <div class="form-group">
        <label for="create_containers_check">Do you want to create source and destination containers for this customer?</label>
        <input
          type="checkbox"
          id="create_containers_check"
          name="create_containers_check"
          checked
          value="true"
        />
      </div>

      <!-- Submit Button -->
      <button type="submit" class="submit-btn">Create Customer</button>
    </form>
  </div>

  <script>
    (function() {
      const form = document.getElementById("configForm");
      const container = document.getElementById("extraColumnsContainer");
      const template = document.getElementById("extraColumnTemplate");
      const addBtn = document.getElementById("addExtraColumnBtn");

      // On page load, clear/reset the form and ensure no extra columns are present
      window.addEventListener("DOMContentLoaded", () => {
        form.reset();
        container.innerHTML = "";
      });

      function addExtraColumn() {
        // Clone the template (deep clone), make it visible, attach a remove handler
        const clone = template.cloneNode(true);
        clone.style.display = "";
        clone.removeAttribute("id");

        // Wire up the “Remove Column” button inside this cloned block
        clone
          .querySelector(".removeColumnBtn")
          .addEventListener("click", function() {
            container.removeChild(clone);
          });

        container.appendChild(clone);
      }

      addBtn.addEventListener("click", addExtraColumn);

      // Optionally, start with one block already present:
      // addExtraColumn();
    })();
  </script>
</body>
</html>
